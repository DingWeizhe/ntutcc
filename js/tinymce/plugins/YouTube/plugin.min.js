(function() {
	tinymce.PluginManager.add('YouTube', function(editor, url){
		editor.addButton('YouTube',{
			image : url + '/img/youtube-icon.gif',
			title : 'YouTube影片',
			onclick : function(){
				editor.windowManager.open({
					title : 'YouTube影片',
					width : 400,
					height : 70,
					inline : true,
					body: [
	                    {type: 'textbox', name: 'youtube_url', label: '影片網址'}
	                ],
	                onsubmit: function(e) {
	                	var youtube_id = e.data.youtube_url.replace(/.*v=([^&]+).*/g,'$1');
	                    editor.insertContent('<embed width="650" height="488" wmode="transparent" src="http://www.youtube.com/v/'+youtube_id+'" type="application/x-shockwave-flash">');
	                },
					buttons: [{
	                    text: '加入',
	                    onclick: 'submit'
	                },{
	                    text: '關閉',
	                    onclick: 'close'
	                }]
				});
			}
		});
	});
})();
